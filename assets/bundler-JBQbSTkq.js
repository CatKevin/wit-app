import{a as h,e as b,i as G,p as f}from"./utils-DfR3noFd.js";import{ab as v,ac as I,ad as U,ae as O,r as x,u as w,b as B,g as E,e as P,f as l,E as m,af as H,h as c,ag as A}from"./index-D5pZEnR3.js";function M(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="event")}function g(t){const{signature:e}=t;let a;return M(e)?a=e:a=h(e),{abiEvent:a,hash:I(a),topics:v({abi:[a],args:t.filters})}}function R(t){const{logs:e,events:a,strict:r}=t;return U({abi:a.map(i=>i.abiEvent),logs:e,strict:r})}function $(t){const{contract:e,method:a,params:r,...i}=t,o=()=>(async()=>{var n,d;if(Array.isArray(a))return a;if(G(a))return f(a);if(typeof a=="function")return f(await a(e));if(typeof a=="string"&&a.startsWith("function ")){const s=h(a);if(s.type==="function")return f(s);throw new Error('"method" passed is not of type "function"')}if(e.abi&&((n=e.abi)==null?void 0:n.length)>0){const s=(d=e.abi)==null?void 0:d.find(p=>p.type==="function"&&p.name===a);if(s)return f(s)}throw new Error(`Could not resolve method "${a}".`)})();return O({...i,chain:e.chain,client:e.client,data:async()=>{let n;return Array.isArray(a)?n=a:n=await o(),n[1].length===0?n[0]:n[0]+b(n[1],await x(r??[])).slice(2)},to:e.address},{contract:e,preparedMethod:o})}function j(t){let e;return()=>(e||(e=t()),e)}function T(t={}){return g({filters:t,signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)"})}function _(t={}){return g({filters:t,signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)"})}function L(t){const{receipt:e}=t,a={...e,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,contractAddress:e.contractAddress?e.contractAddress:null,cumulativeGasUsed:e.cumulativeGasUsed?BigInt(e.cumulativeGasUsed):null,effectiveGasPrice:e.effectiveGasPrice?BigInt(e.effectiveGasPrice):null,gasUsed:e.gasUsed?BigInt(e.gasUsed):null,logs:e.logs,status:e.status,to:e.to?e.to:null,transactionHash:e.transactionHash,transactionIndex:e.transactionIndex,type:e.type};return e.blobGasPrice&&(a.blobGasPrice=BigInt(e.blobGasPrice)),e.blobGasUsed&&(a.blobGasUsed=BigInt(e.blobGasUsed)),{...t,actualGasCost:BigInt(t.actualGasCost),actualGasUsed:BigInt(t.actualGasUsed),nonce:BigInt(t.nonce),receipt:a,userOpHash:t.userOpHash}}const k=()=>{const t=BigInt(Math.floor(Math.random()*4294967296)),e=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296)),r=BigInt(Math.floor(Math.random()*4294967296)),i=BigInt(Math.floor(Math.random()*4294967296)),o=BigInt(Math.floor(Math.random()*4294967296));return t<<BigInt(160)|e<<BigInt(128)|a<<BigInt(96)|r<<BigInt(64)|i<<BigInt(32)|o};function y(t){return Object.fromEntries(Object.entries(t).map(([e,a])=>[e,a==null||B(a)?a:w(a)]))}async function S(t){return u({...t,operation:"eth_sendUserOperation",params:[y(t.userOp),t.options.entrypointAddress??m]})}async function D(t,e){const a=await u({...t,operation:"eth_estimateUserOperationGas",params:[y(t.userOp),t.options.entrypointAddress??m,e??{}]});return{callGasLimit:c(a.callGasLimit)+A,paymasterPostOpGasLimit:a.paymasterPostOpGasLimit!==void 0?c(a.paymasterPostOpGasLimit):void 0,paymasterVerificationGasLimit:a.paymasterVerificationGasLimit!==void 0?c(a.paymasterVerificationGasLimit):void 0,preVerificationGas:c(a.preVerificationGas),verificationGas:a.verificationGas!==void 0?c(a.verificationGas):void 0,verificationGasLimit:c(a.verificationGasLimit)}}async function V(t){const e=await u({...t,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxFeePerGas:c(e.maxFeePerGas),maxPriorityFeePerGas:c(e.maxPriorityFeePerGas)}}async function W(t){var a,r;const e=await C(t);if(e){if(e.success===!1){const o=(r=(a=R({events:[T(),_()],logs:e.logs})[0])==null?void 0:a.args)==null?void 0:r.revertReason;if(!o)throw new Error(`UserOp failed at txHash: ${e.receipt.transactionHash}`);const n=H({data:o});throw new Error(`UserOp failed with reason: '${n.args.join(",")}' at txHash: ${e.receipt.transactionHash}`)}return e.receipt}}async function C(t){const e=await u({operation:"eth_getUserOperationReceipt",options:t,params:[t.userOpHash]});if(e)return L(e)}async function q(t){const e=await u({operation:"zk_paymasterData",options:t.options,params:[t.transaction]});return{paymaster:e.paymaster,paymasterInput:e.paymasterInput}}async function z(t){const e=await u({...t,operation:"tw_execute",params:[t.eoaAddress,t.wrappedCalls,t.signature,t.authorization]});if(!e.queueId)throw new Error(`Error executing 7702 transaction: ${l(e)}`);return{transactionId:e.queueId}}async function Z(t){return{transactionHash:(await u({...t,operation:"tw_getTransactionHash",params:[t.transactionId]})).transactionHash}}async function K(t){return{transactionHash:(await u({operation:"zk_broadcastTransaction",options:t.options,params:[{...t.transaction,signedTransaction:t.signedTransaction}]})).transactionHash}}async function u(t){const{options:e,operation:a,params:r}=t,i=e.bundlerUrl??E(e.chain),n=await P(e.client)(i,{useAuthToken:!0,body:l({id:1,jsonrpc:"2.0",method:a,params:r}),headers:{"Content-Type":"application/json"},method:"POST"}),d=await n.json();if(!n.ok||d.error){let s=d.error||n.statusText;typeof s=="object"&&(s=l(s));const p=d.code||"UNKNOWN";throw new Error(`${a} error: ${s}
Status: ${n.status}
Code: ${p}`)}return d.result}export{V as a,k as b,q as c,K as d,D as e,S as f,W as g,y as h,z as i,Z as j,j as o,$ as p};
